<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>

<body style="background-color: aliceblue;">
    <script>
        function onload() {
            const token = sessionStorage.getItem("token");

            const myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + token);

            const requestOptions = {
                method: "GET",
                headers: myHeaders
            };
            fetch("http://localhost:8080/user/rest/get-allProperty", requestOptions)
                .then((response) => response.json())
                .then((result) => {
                    const resp = result;
                    loadData(resp.body.properties);
                })
                .catch((error) => console.error(error));

            function loadData(properties) {
                const tbody = document.getElementById("content");
                tbody.innerHTML = '';
                if (properties.length == 0) {
                    tbody.innerHTML = `<span>No Record</span>`;
                } else {
                    properties.forEach(property => {
                        tbody.innerHTML = tbody.innerHTML + `
                        <div class="card" style="width: 18rem;">
                            <img src="${property.imageUrl}" class="card-img-top" alt="Image">
                            <div class="card-body">
                                <h5 class="card-title">${property.title}</h5>
                                <div class="card-text">₹ ${property.price}</div>
                                <div class="card-text">${property.location}</div>
                                <div class="card-text">${property.type}</div><br />
                                <a href="" class="btn btn-primary" onclick="propertyDetailsPage(${property.id})">View in detail</a>
                            </div>
                        </div>`
                    })
                }
            }
        }
        onload();
        function filter() {
            const token = sessionStorage.getItem("token");

            const myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + token);

            const requestOptions = {
                method: "GET",
                headers: myHeaders
            };
            fetch("http://localhost:8080/user/rest/get-allProperty", requestOptions)
                .then((response) => response.json())
                .then((result) => {
                    const resp = result;
                    loadData(resp.body.properties);
                })
                .catch((error) => console.error(error));

            function loadData(properties) {

                let filterType = null;
                if (document.getElementById("type1").checked) {
                    filterType = "Sale";
                } else if (document.getElementById("type2").checked) {
                    filterType = "Rent";
                }
                if (filterType != null) {
                    properties = properties.filter(property => property.type == filterType);
                }

                const location = document.getElementById("location").value;
                if (location != "") {
                    properties = properties.filter(property => property.location == location);
                }

                const minPrice = document.getElementById("min").value;
                const maxPrice = document.getElementById("max").value;
                if (minPrice != "" && maxPrice != "") {
                    properties = properties.filter(property => (property.price >= minPrice) && (property.price <= maxPrice));
                }

                const title = document.getElementById("title").value;
                if (title != "") {
                    properties = properties.filter(property => property.title.toLowerCase().includes(title.toLowerCase()));
                }

                const tbody = document.getElementById("content");
                tbody.innerHTML = '';

                if (properties.length == 0) {
                    tbody.innerHTML = `<span>No Record</span>`;
                } else {
                    properties.forEach(property => {
                        tbody.innerHTML = tbody.innerHTML + `
                        <div class="card" style="width: 18rem;">
                            <img src="${property.imageUrl}" class="card-img-top" alt="Image">
                            <div class="card-body">
                                <h5 class="card-title">${property.title}</h5>
                                <div class="card-text">₹ ${property.price}</div>
                                <div class="card-text">${property.location}</div>
                                <div class="card-text">${property.type}</div><br />
                                <a href="" class="btn btn-primary" onclick="propertyDetailsPage(${property.id})">View in detail</a>
                            </div>
                        </div>`
                    })
                }
            }
        }
        function propertyPage() {
            const token = sessionStorage.getItem("token");

            const myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + token);
            const requestOptions = {
                method: "GET",
                headers: myHeaders,
                redirect: "follow"
            };
            fetch("http://localhost:8080/user/property", requestOptions)
                .then((response) => response.text())
                .then((html) => {
                    document.write(html);
                    document.close();
                })
                .catch((error) => console.error(error));
        }
        function propertyDetailsPage(id) {
            const token = sessionStorage.getItem("token");

            const myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + token);
            const requestOptions = {
                method: "GET",
                headers: myHeaders,
                redirect: "follow"
            };
            fetch("http://localhost:8080/user/property-details", requestOptions)
                .then((response) => response.text())
                .then((html) => {
                    document.write(html);
                    document.close();
                })
                .catch((error) => console.error(error));

                sessionStorage.setItem("propertyId", id);
        }
    </script>
    <header>
        <div class="row border fixed-top" style="background-color:antiquewhite;">
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-4 m-3">
                <nav class="nav"><a href="" class="nav-link" onclick="propertyPage()">Add Property</a></nav>
            </div>
            <div class="col md-2 m-3 border-start border-dark-subtle">
                <a href="http://localhost:8080/" class="btn btn-danger link-dark"><svg
                        xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                        fill="#1f1f1f" class="d-inline">
                        <path
                            d="M216-144q-29.7 0-50.85-21.15Q144-186.3 144-216v-528q0-29.7 21.15-50.85Q186.3-816 216-816h264v72H216v528h264v72H216Zm432-168-51-51 81-81H384v-72h294l-81-81 51-51 168 168-168 168Z" />
                    </svg></svg>Logout</a>
            </div>
        </div>
    </header>
    <main>
        <div class="container border border-top-0 border-secondary mt-5 p-5">
            <div class="row">
                <div class="col sm-4">
                    <label for="location" class="form-label">Location:</label>
                    <input type="text" placeholder="Enter location" id="location" class="form-control" />
                    <label for="price" class="form-label">Price range:</label>
                    <div class="row g-2">
                        <div class="col-auto">
                            <input type="number" placeholder="Enter min" id="min" class="form-control" />
                        </div>
                        <div class="col-auto">
                            <input type="number" placeholder="Enter max" id="max" class="form-control" />
                        </div>
                    </div>
                    <label for="title" class="form-label">Title:</label>
                    <input type="text" placeholder="Enter title (keyword)" id="title" class="form-control" />
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="type" id="type1" />
                        <label class="form-check-label" for="type1">
                            For sale
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="type" id="type2" />
                        <label class="form-check-label" for="type2">
                            For rent
                        </label>
                    </div>
                    <br /><button class="btn btn-primary" onclick="filter()">Filter</button>
                </div>
                <div class="col sm-2"></div>
            </div>
        </div><br />
        <div class="container">
            <div class="border-bottom border-black">
            <h1>Property List</h1>
        </div>
        </div>
        <div class="container border border-secondary p-5 mt-5 d-flex flex-wrap justify-content-evenly" id="content">
        </div>
    </main>

</body>

</html>